---
import Layout from '@layouts/BlogPost.astro'
import {portableTextToHtml} from '@lib/portableText'
import {getAllPosts, getPostBySlug} from '@lib/sanity'

export async function getStaticPaths() {
  const posts = await getAllPosts()
  return posts.map((post) => ({
    params: {slug: post.slug},
  }))
}

interface Props {
  slug: string;
}

const {slug} = Astro.props
const post = await getPostBySlug(slug)

if (!post) {
  throw new Error(`Post not found for slug: ${slug}`)
}

const bodyHtml = portableTextToHtml(post.body ?? [])
const authorName = post.author?.name ?? 'Psicóloga em Outra Dimensão'
const pubDate = post.publishedAt ? new Date(post.publishedAt) : new Date()
---

<Layout
  title={post.title}
  description={post.description ?? ''}
  pubDate={pubDate}
  author={authorName}
  headings={[]}
>
  <div class='portable-text' set:html={bodyHtml} />
</Layout>
