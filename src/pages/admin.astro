---
import Layout from '@layouts/Default.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('blog');
const sortedPosts = posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<Layout
  title="Admin - Psicóloga em Outra Dimensão"
  description="Painel administrativo para gerenciar posts do blog"
>
  <main class="container mx-auto px-4 py-8">
    <div class="max-w-6xl mx-auto">
      <div class="flex justify-between items-center mb-8">
        <h1 class="text-4xl font-bold text-deep">Admin Panel</h1>
        <a
          href="/admin/new-post"
          class="brutal-button bg-primary text-white px-6 py-3 rounded-lg hover:bg-primary/90 transition-colors"
        >
          Novo Post
        </a>
      </div>

      <!-- Stats Cards -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="brutal-card bg-white p-6 rounded-lg">
          <h3 class="text-lg font-semibold text-deep mb-2">Total de Posts</h3>
          <p class="text-3xl font-bold text-primary">{posts.length}</p>
        </div>

        <div class="brutal-card bg-white p-6 rounded-lg">
          <h3 class="text-lg font-semibold text-deep mb-2">Posts Publicados</h3>
          <p class="text-3xl font-bold text-secondary">{posts.filter(post => !post.data.draft).length}</p>
        </div>

        <div class="brutal-card bg-white p-6 rounded-lg">
          <h3 class="text-lg font-semibold text-deep mb-2">Rascunhos</h3>
          <p class="text-3xl font-bold text-accent">{posts.filter(post => post.data.draft).length}</p>
        </div>
      </div>

      <!-- Posts Table -->
      <div class="brutal-card bg-white rounded-lg overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-200">
          <h2 class="text-xl font-semibold text-deep">Posts do Blog</h2>
        </div>

        <div class="overflow-x-auto">
          <table class="w-full">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Título</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Categoria</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              {sortedPosts.map((post) => (
                <tr class="hover:bg-gray-50">
                  <td class="px-6 py-4">
                    <div class="flex items-center">
                      <div>
                        <div class="text-sm font-medium text-gray-900">{post.data.title}</div>
                        <div class="text-sm text-gray-500 truncate max-w-md">{post.data.description}</div>
                      </div>
                    </div>
                  </td>

                  <td class="px-6 py-4 whitespace-nowrap">
                    <span class={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                      post.data.draft
                        ? 'bg-yellow-100 text-yellow-800'
                        : 'bg-green-100 text-green-800'
                    }`}>
                      {post.data.draft ? 'Rascunho' : 'Publicado'}
                    </span>
                    {post.data.featured && (
                      <span class="ml-2 inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-purple-100 text-purple-800">
                        Destaque
                      </span>
                    )}
                  </td>

                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    {post.data.category || 'Sem categoria'}
                  </td>

                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    {post.data.pubDate.toLocaleDateString('pt-BR')}
                  </td>

                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                    <a href={`/blog/${post.slug}`} class="text-primary hover:text-primary/80">Visualizar</a>
                    <a href={`/admin/edit/${post.slug}`} class="text-accent hover:text-accent/80">Editar</a>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </main>
</Layout>

<style>
  .brutal-card {
    box-shadow: 4px 4px 0px 0px rgba(0, 0, 0, 1);
    border: 2px solid #000;
  }

  .brutal-button {
    box-shadow: 3px 3px 0px 0px rgba(0, 0, 0, 1);
    border: 2px solid #000;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .brutal-button:hover {
    transform: translate(1px, 1px);
    box-shadow: 2px 2px 0px 0px rgba(0, 0, 0, 1);
  }
</style>